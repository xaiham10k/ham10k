<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ISIC visualisations</title>
<style>
  *,*::before,*::after{box-sizing:border-box}
  body{font-family:sans-serif;padding:20px;text-align:center}

  .controls{margin-bottom:30px}
  .toggle-switch{display:inline-flex;align-items:center;gap:10px;font-weight:700}

  .switch{position:relative;width:50px;height:26px}
  .switch input{opacity:0;width:0;height:0}
  .slider{position:absolute;inset:0;border-radius:26px;background:#2196f3;cursor:pointer;transition:.3s}
  .slider::before{content:"";position:absolute;left:3px;bottom:3px;width:20px;height:20px;border-radius:50%;background:#fff;transition:.3s}
  .switch input:checked + .slider::before{transform:translateX(24px)}

  .slider-label{display:flex;flex-wrap:wrap;align-items:center;justify-content:center;gap:20px;margin-top:10px}
  .slider-control{display:flex;align-items:center;gap:8px}
  #opacityValue{display:inline-block;width:48px;text-align:right}
  #imageSelect{margin-top:10px;font-size:1rem}

  .container{max-width:900px;margin:0 auto;display:flex;flex-direction:column;align-items:center;gap:20px}
  .image-row{display:flex;flex-wrap:wrap;justify-content:center;gap:20px;width:100%}
  .image-block{width:200px}
  .overlay-container{position:relative;width:100%}

  .overlay-container img{display:block;width:100%;height:auto;border:1px solid #ccc}
  .overlay{
    position:absolute;inset:0;
    width:100%;height:100%;
    object-fit:contain;
    transition:opacity .2s ease;
    pointer-events:none;
  }

  .caption{margin-top:4px;font-size:.9em;color:#555}
  .description-box{text-align:left;padding:15px;border:1px solid #ccc;background:#f9f9f9;width:100%}
</style>
</head>
<body>

<h1>CNN visualisations <a href="tab.html">[switch to tabular]</a></h1>

<div class="controls">
  <div class="toggle-switch">
    <span>ResNet</span>
    <label class="switch">
      <input type="checkbox" id="modelToggle">
      <span class="slider"></span>
    </label>
    <span>EfficientNet</span>
  </div>

  <div class="slider-label">
    <div class="slider-control">
      Opacity: <span id="opacityValue">100%</span>
      <input type="range" id="opacitySlider" min="0" max="100" value="100">
    </div>
    <label><input type="checkbox" id="overlayToggle" checked> Show overlays</label>
  </div>

  <div>
    <label for="imageSelect">Select image:</label>
    <select id="imageSelect"></select>
  </div>
</div>

<div class="container">
  <div id="predictionSummary" style="font-weight:bold; margin-bottom:10px;"></div>

  <div class="image-row">
    <div class="image-block">
      <div class="overlay-container">
        <img id="rawImage" alt="raw">
      </div>
      <div class="caption">Raw (reference)</div>
    </div>
    <div class="image-block">
      <div class="overlay-container">
        <img class="base" id="gcBase" alt="">
        <img class="overlay" id="gradcam" alt="grad-cam">
      </div>
      <div class="caption">Grad-CAM</div>
    </div>
    <div class="image-block">
      <div class="overlay-container">
        <img class="base" id="igBase" alt="">
        <img class="overlay" id="ig" alt="integrated-gradients">
      </div>
      <div class="caption">Integrated Gradients</div>
    </div>
    <div class="image-block">
      <div class="overlay-container">
        <img class="base" id="limeBase" alt="">
        <img class="overlay" id="lime" alt="lime">
      </div>
      <div class="caption">LIME</div>
    </div>
  </div>

  <div class="description-box" id="desc"></div>
</div>

<script>
let DATA = [];

fetch('./web/xai_picks.json')
  .then(res => res.json())
  .then(json => {
    DATA = json;

    // Populate dropdown
    DATA.forEach(d => {
      const o = document.createElement('option');
      o.value = o.textContent = d.image_id;
      imageSelect.appendChild(o);
    });

    imageSelect.value = DATA[0]?.image_id || '';
    updateImages(); updateOpacity(); updateOverlayVis();
  })
  .catch(err => {
    console.error('Failed to load data.json:', err);
    desc.textContent = 'Error loading image data.';
  });


const imageSelect = document.getElementById('imageSelect');
const modelToggle  = document.getElementById('modelToggle');
const overlayToggle= document.getElementById('overlayToggle');
const opacitySlider= document.getElementById('opacitySlider');
const opacityValue = document.getElementById('opacityValue');
const desc         = document.getElementById('desc');

const raw       = document.getElementById('rawImage');
const gcBase    = document.getElementById('gcBase');
const igBase    = document.getElementById('igBase');
const limeBase  = document.getElementById('limeBase');
const gradcam   = document.getElementById('gradcam');
const ig        = document.getElementById('ig');
const lime      = document.getElementById('lime');
const overlays  = [gradcam, ig, lime];

DATA.forEach(d=>{
  const o=document.createElement('option');
  o.value=o.textContent=d.image_id;
  imageSelect.appendChild(o);
});
imageSelect.value='ISIC_0028999';

const current = ()=>DATA.find(d=>d.image_id===imageSelect.value);
const model   = ()=>modelToggle.checked?'effnet':'resnet';

function updateImages(){
  const d=current(), m=model();
  raw.src = 'images/' + d.images.raw;

  gcBase.src = igBase.src = limeBase.src = 'images/' + d.images.raw;
  gradcam.src = 'images/' + d.images[`${m}_gradcam`];
  ig.src      = 'images/' + d.images[`${m}_ig`];
  lime.src    = 'images/' + d.images[`${m}_lime`];

  document.getElementById('predictionSummary').textContent =
    `True: ${d.true_label}   •   ResNet: ${d.resnet_pred} (${d.resnet_conf.toFixed(2)})   •   EfficientNet: ${d.effnet_pred} (${d.effnet_conf.toFixed(2)})`;

  desc.textContent = d.text_box || '';
}

function updateOpacity(){
  const op = +opacitySlider.value/100;
  opacityValue.textContent = opacitySlider.value + '%';
  overlays.forEach(img => img.style.opacity = op);
}

function updateOverlayVis(){
  overlays.forEach(img => img.style.display = overlayToggle.checked ? 'block' : 'none');
}

imageSelect .addEventListener('change', updateImages);
modelToggle .addEventListener('change', updateImages);
opacitySlider.addEventListener('input', updateOpacity);
overlayToggle.addEventListener('change', updateOverlayVis);

updateImages(); updateOpacity(); updateOverlayVis();
</script>
</body>
</html>
